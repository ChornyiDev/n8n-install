#!/bin/bash

echo "========== $(date '+%Y-%m-%d %H:%M:%S') =========="

# –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É –≤–µ—Ä—Å—ñ—é
OLD_VERSION=$(n8n --version 2>/dev/null)

# –û–Ω–æ–≤–ª–µ–Ω–Ω—è
npm update -g n8n >/dev/null 2>&1

# –û—Ç—Ä–∏–º—É—î–º–æ –Ω–æ–≤—É –≤–µ—Ä—Å—ñ—é
NEW_VERSION=$(n8n --version 2>/dev/null)

# –Ø–∫—â–æ –≤–µ—Ä—Å—ñ—è –∑–º—ñ–Ω–∏–ª–∞—Å—è ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ
if [[ "$OLD_VERSION" != "$NEW_VERSION" ]]; then
  echo "üîÑ –í–µ—Ä—Å—ñ—è –∑–º—ñ–Ω–∏–ª–∞—Å—å: $OLD_VERSION ‚Üí $NEW_VERSION"
  echo "üîë –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–ª—É–∂–±—É n8n..."
  systemctl restart n8n 2>&1
  echo "‚úÖ n8n –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–æ –≤–µ—Ä—Å—ñ—ó $NEW_VERSION"
else
  echo "‚ÑπÔ∏è n8n –≤–∂–µ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó: $NEW_VERSION"
fi

echo "============================================="